import type { NextApiRequest, NextApiResponse } from 'next'; import { getRoomState, saveRoomState } from '@/lib/rooms'; export default async function h(req:NextApiRequest,res:NextApiResponse){ const roomId=(req.query.roomId as string)||(req.body?.roomId as string); if(!roomId) return res.status(400).json({error:'roomId required'}); if(req.method==='GET'){ const s=await getRoomState(roomId); return res.json(s||{});} if(req.method==='POST'){ const state=req.body?.state||{}; await saveRoomState(roomId,state); return res.json({ok:true}); } return res.status(405).json({error:'Method Not Allowed'}); }